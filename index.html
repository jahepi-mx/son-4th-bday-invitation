<html>
    <head>
        <style type="text/css">
            #canvas { 
                height: 100vh; 
                width: 100vw;
                display: block;
                position: fixed; 
                top: 0;
                left: 0;
                z-index: -1;
            }
        </style>
        <script src="assets.js"></script>
        <script src="atlas.js"></script>
        <script src="animation.js"></script>
        <script src="vector.js"></script>
        <script src="camera.js"></script>
        <script src="chase.js"></script>
        <script src="ball.js"></script>
        <script src="background.js"></script>
        <script>
        var canvas = null;
        var context = null;
        var camera = new Camera();
        var backgrounds = [];
        var prevTime = 0;
        var bots = [];
        var focusTime = 0;
        var focusVector = new Vector();
        var bot = null;

        window.onload = function() {
            canvas = document.getElementById("canvas");
            canvas.width = camera.viewPortWidth;
            canvas.height = camera.viewPortHeight;
            context = canvas.getContext("2d");
            bots = [new Chase(camera), new Chase(camera)];
            var assets = Assets.getInstance();
            assets.loadAll(onLoadAssets, onDownloadAssets);
        }

        function onDownloadAssets() {
        }
            
        function onLoadAssets() {
            var atlas = Atlas.getInstance();
            atlas.loadAll(onLoadAtlas, onDownloadAtlas);
        }

        function onDownloadAtlas() {
        }
            
        function onLoadAtlas() {
            backgrounds = [
                new Background(camera, "clouds", 0.4, camera.viewPortHeight - 300 * 0.5, 300), 
                new Background(camera, "mountains", 0.6, 200, 150), 
                new Background(camera, "trees", 0.8, 120, 150),
                new Background(camera, "floors", 1, 65 * 0.5, 65)
            ];
            requestAnimationFrame(update);
        }

        function update(time) {
            context.clearRect(0, 0, canvas.width, canvas.height);
            context.imageSmoothingEnabled = false;
            var dt = (time - prevTime) / 1000;
            var fps = 1 / dt;
            focusTime -= dt;

            if (focusTime <= 0) {
                focusTime = Math.random() * 10 + 10;
                bot = bots[parseInt(bots.length * Math.random())];
            }

            focusVector.x += (bot.position.x - focusVector.x) * dt;
            focusVector.y += (bot.position.y - focusVector.y) * dt;

            camera.update(focusVector);

            for (let background of backgrounds) {
                background.update(dt, focusVector);
                background.render(context);
            }

            for (let tmpBot of bots) {
                tmpBot.update(dt);
                tmpBot.render(context);
            }

            prevTime = time;
            requestAnimationFrame(update);
        }
        </script>
    </head>
    <body style="margin:0; padding: 0">
        <div style="z-index: 0;">
            <h3></h3>
        </div>
        <canvas id="canvas" name="canvas" />
    </body>
</html>